"0",""
"0","library(purrr)"
"0","library(dplyr)"
"0",""
"0","d = readr::read_tsv(""http://download.gbif.org/custom_download/jwaller/country_counts_time_series.tsv"") %>%"
"0","mutate(iso2 = country) %>%"
"0","merge(gbifapi::get_gbif_countries(),id=""iso2"") %>%"
"0","janitor::clean_names() %>%"
"0","mutate(snapshot=stringr::str_replace_all(snapshot,""occurrence_"","""")) %>%"
"0","mutate(date=lubridate::ymd(snapshot)) %>%"
"0","mutate(gbif_region = stringr::str_replace_all(gbif_region,""_"","" "")) %>%"
"0","mutate(gbif_region = stringr::str_to_title(gbif_region)) %>%"
"0","mutate(gbif_region = gbifapi::replace_gbif_region(gbif_region,shorten=FALSE)) %>%"
"0","filter(!gbif_region == ""Antarctica"") %>% "
"0","glimpse()"
"1","Observations: 16,139
"
"1","Variables: 12
"
"1","$ iso2          [3m[90m<chr>[39m[23m ""AD"", ""AD"", ""AD"", ""AD"", ""AD"", ""AD"", ""...
"
"1",""
"1","$ country       [3m[90m<chr>[39m[23m ""AD"", ""AD"", ""AD"", ""AD"", ""AD"", ""AD"", ""...
"
"1",""
"1","$ occ_count     [3m[90m<dbl>[39m[23m 81816, 127030, 126195, 81816, 86865, ...
"
"1",""
"1","$ species_count [3m[90m<dbl>[39m[23m 2544, 4939, 4888, 2551, 3171, 3383, 1...
"
"1",""
"1","$ snapshot      [3m[90m<chr>[39m[23m ""20130709"", ""20170724"", ""20161227"", ""...
"
"1",""
"1","$ type          [3m[90m<chr>[39m[23m ""published"", ""about"", ""about"", ""publi...
"
"1",""
"1","$ enum_name     [3m[90m<chr>[39m[23m ""ANDORRA"", ""ANDORRA"", ""ANDORRA"", ""AND...
"
"1",""
"1","$ gbif_region   [3m[90m<chr>[39m[23m ""Europe and Central Asia"", ""Europe an...
"
"1",""
"1","$ iso3          [3m[90m<chr>[39m[23m ""AND"", ""AND"", ""AND"", ""AND"", ""AND"", ""A...
"
"1",""
"1","$ iso_numerical [3m[90m<chr>[39m[23m ""20"", ""20"", ""20"", ""20"", ""20"", ""20"", ""...
"
"1",""
"1","$ title         [3m[90m<chr>[39m[23m ""Andorra"", ""Andorra"", ""Andorra"", ""And...
"
"1",""
"1","$ date          [3m[90m<date>[39m[23m 2013-07-09, 2017-07-24, 2016-12-27, ...
"
"0","d_published = d %>% "
"0","filter(type == ""published"") %>%"
"0","filter(!is.na(country)) %>%  "
"0","mutate(merge_id = paste(snapshot,country,sep=""_"")) %>%"
"0","mutate(occ_count_published = occ_count) %>%"
"0","mutate(species_count_published = species_count) %>%"
"0","select(merge_id,occ_count_published,species_count_published) %>%"
"0","glimpse()"
"1","Observations: 4,232
"
"1","Variables: 3
"
"1","$ merge_id                [3m[90m<chr>[39m[23m ""20130709_AD"", ""20151001_AD...
"
"1",""
"1","$ occ_count_published     [3m[90m<dbl>[39m[23m 81816, 81816, 111790, 11071...
"
"1",""
"1","$ species_count_published [3m[90m<dbl>[39m[23m 2544, 2551, 4096, 4091, 409...
"
"0","d_about = d %>% "
"0","filter(type == ""about"") %>%"
"0","mutate(merge_id = paste(snapshot,country,sep=""_"")) %>%"
"0","select(merge_id,date,country,title,gbif_region,occ_count,species_count) "
"0",""
"0","d = merge(d_about,d_published,id=""merge_id"",all.x=TRUE) %>%"
"0","select(-merge_id) %>%"
"0","glimpse()"
"1","Observations: 11,907
"
"1","Variables: 8
"
"1","$ date                    [3m[90m<date>[39m[23m 2007-12-19, 2007-12-19, 20...
"
"1",""
"1","$ country                 [3m[90m<chr>[39m[23m ""AD"", ""AE"", ""AF"", ""AG"", ""AI...
"
"1",""
"1","$ title                   [3m[90m<chr>[39m[23m ""Andorra"", ""United Arab Emi...
"
"1",""
"1","$ gbif_region             [3m[90m<chr>[39m[23m ""Europe and Central Asia"", ...
"
"1",""
"1","$ occ_count               [3m[90m<dbl>[39m[23m 12896, 973, 22069, 3009, 22...
"
"1",""
"1","$ species_count           [3m[90m<dbl>[39m[23m 9923, 286, 2424, 506, 510, ...
"
"1",""
"1","$ occ_count_published     [3m[90m<dbl>[39m[23m NA, NA, NA, NA, NA, NA, NA,...
"
"1",""
"1","$ species_count_published [3m[90m<dbl>[39m[23m NA, NA, NA, NA, NA, NA, NA,...
"
"0","if(TRUE) { # parameters "
"0","parameters_occ_published = tibble("
"0","variable = ""occ_count_published"","
"0","gbif_region = unique(d$gbif_region)"
"0",") %>% "
"0","mutate(plot_title = paste0(gbif_region, """")) %>% "
"0","mutate(plot_subtitle = ""Number of occurrences published by country on GBIF"") %>% "
"0","mutate(y_lab = ""number of occurrences"") %>%"
"0","mutate(filter_count = 5e5) %>%"
"0","mutate(country_text_size = 11) %>%"
"0","mutate(unit_scale = 1e-6) %>%"
"0","mutate(unit_MK = ""M"") %>%"
"0","mutate(gain_color =  ""#40BFFF"") %>% "
"0","mutate(comparison_snapshot = ""2015-01-19"") %>%"
"0","mutate(comparison_snapshot_label = ""2015"")"
"0",""
"0","parameters_species_published = tibble("
"0","variable = ""species_count_published"","
"0","gbif_region = d %>% pull(gbif_region) %>% unique()"
"0",") %>% "
"0","mutate(plot_title = paste0(gbif_region, """")) %>% "
"0","mutate(plot_subtitle = ""Number of species published by country on GBIF"") %>% "
"0","mutate(y_lab = ""number of species"") %>%"
"0","mutate(filter_count = 1000) %>%"
"0","mutate(country_text_size = 11) %>%"
"0","mutate(unit_scale = 1e-3) %>%"
"0","mutate(unit_MK = ""K"") %>%"
"0","mutate(gain_color =  ""#D66F27"") %>% "
"0","mutate(comparison_snapshot = ""2015-01-19"") %>%"
"0","mutate(comparison_snapshot_label = ""2015"")"
"0",""
"0","parameters_num_species = tibble("
"0","variable = ""species_count"","
"0","gbif_region = d %>% pull(gbif_region) %>% unique()"
"0",") %>% "
"0","mutate(plot_title = paste0(gbif_region, """")) %>% "
"0","mutate(plot_subtitle = ""Number of species about country on GBIF"") %>% "
"0","mutate(y_lab = ""number of species"") %>%"
"0","mutate(filter_count = 1e4) %>%"
"0","mutate(country_text_size = 11) %>%"
"0","mutate(unit_scale = 1e-3) %>%"
"0","mutate(unit_MK = ""K"") %>%"
"0","mutate(gain_color =  ""#FDAF02"") %>% "
"0","mutate(comparison_snapshot = ""2015-01-19"") %>%"
"0","mutate(comparison_snapshot_label = ""2015"") "
"0",""
"0","parameters_num_of_occ = tibble("
"0","variable = ""occ_count"","
"0","gbif_region = d %>% pull(gbif_region) %>% unique()"
"0",") %>% "
"0","mutate(plot_title = paste0(gbif_region, """")) %>% "
"0","mutate(plot_subtitle = ""Number of occurrences about country on GBIF"") %>% "
"0","mutate(y_lab = ""number of occurrences"") %>%"
"0","mutate(filter_count = 1e6) %>%"
"0","mutate(country_text_size = 11) %>%"
"0","mutate(unit_scale = 1e-6) %>%"
"0","mutate(unit_MK = ""M"") %>%"
"0","mutate(gain_color =  ""#509E2F"") %>% "
"0","mutate(comparison_snapshot = ""2015-01-19"") %>%"
"0","mutate(comparison_snapshot_label = ""2015"") "
"0",""
"0","}"
"0",""
"0","################################################# Global Parameters "
"0",""
"0","parameters_num_of_occ_global = tibble("
"0","variable = ""occ_count"","
"0","gbif_region = ""Global"""
"0",") %>% "
"0","mutate(plot_title = paste0(gbif_region, """")) %>% "
"0","mutate(plot_subtitle = ""Number of occurrences about country on GBIF"") %>% "
"0","mutate(y_lab = ""number of occurrences"") %>%"
"0","mutate(filter_count = 5e6) %>%"
"0","mutate(country_text_size = 11) %>%"
"0","mutate(unit_scale = 1e-6) %>%"
"0","mutate(unit_MK = ""M"") %>%"
"0","mutate(gain_color =  ""#509E2F"") %>% "
"0","mutate(comparison_snapshot = ""2015-01-19"") %>%"
"0","mutate(comparison_snapshot_label = ""2015"") "
"0",""
"0","parameters_num_species_global = tibble("
"0","variable = ""species_count"","
"0","gbif_region = ""Global"""
"0",") %>% "
"0","mutate(plot_title = paste0(gbif_region, """")) %>% "
"0","mutate(plot_subtitle = ""Number of species about country on GBIF"") %>% "
"0","mutate(y_lab = ""number of species"") %>%"
"0","mutate(filter_count = 5e4) %>%"
"0","mutate(country_text_size = 11) %>%"
"0","mutate(unit_scale = 1e-3) %>%"
"0","mutate(unit_MK = ""K"") %>%"
"0","mutate(gain_color =  ""#FDAF02"") %>% "
"0","mutate(comparison_snapshot = ""2015-01-19"") %>%"
"0","mutate(comparison_snapshot_label = ""2015"") "
"0",""
"0","parameters_occ_published_global = tibble("
"0","variable = ""occ_count_published"","
"0","gbif_region = ""Global"""
"0",") %>% "
"0","mutate(plot_title = paste0(gbif_region, """")) %>% "
"0","mutate(plot_subtitle = ""Number of occurrences published by country on GBIF"") %>% "
"0","mutate(y_lab = ""number of occurrences"") %>%"
"0","mutate(filter_count = 5e5) %>%"
"0","mutate(country_text_size = 11) %>%"
"0","mutate(unit_scale = 1e-6) %>%"
"0","mutate(unit_MK = ""M"") %>%"
"0","mutate(gain_color =  ""#40BFFF"") %>% "
"0","mutate(comparison_snapshot = ""2015-01-19"") %>%"
"0","mutate(comparison_snapshot_label = ""2015"")"
"0",""
"0","parameters_species_published_global = tibble("
"0","variable = ""species_count_published"","
"0","gbif_region = ""Global"""
"0",") %>% "
"0","mutate(plot_title = paste0(gbif_region, """")) %>% "
"0","mutate(plot_subtitle = ""Number of species published by country on GBIF"") %>% "
"0","mutate(y_lab = ""number of species"") %>%"
"0","mutate(filter_count = 5e4) %>%"
"0","mutate(country_text_size = 11) %>%"
"0","mutate(unit_scale = 1e-3) %>%"
"0","mutate(unit_MK = ""K"") %>%"
"0","mutate(gain_color =  ""#D66F27"") %>% "
"0","mutate(comparison_snapshot = ""2015-01-19"") %>%"
"0","mutate(comparison_snapshot_label = ""2015"")"
"0",""
"0",""
"0",""
"0","parameters = rbind("
"0","    parameters_num_of_occ,"
"0","    parameters_num_species,"
"0","    parameters_occ_published,"
"0","    parameters_species_published,"
"0","    parameters_num_of_occ_global,"
"0","    parameters_num_species_global,"
"0","    parameters_occ_published_global,"
"0","    parameters_species_published_global"
"0","    ) %>%"
"0","purrr::transpose()"
"0",""
"0",""
"0","library(ggplot2)"
"0",""
"0","parameters %>%"
"0","map( ~"
"0","gbifregionalstats::plot_country_dotplot("
"0","d,"
"0","variable = .x$variable,"
"0","plot_title = .x$plot_title,"
"0","y_lab = .x$y_lab,"
"0","country_text_size = .x$country_text_size,"
"0","gbif_region = .x$gbif_region,"
"0","filter_count = .x$filter_count,"
"0","plot_subtitle = .x$plot_subtitle,"
"0","unit_MK = .x$unit_MK,"
"0","unit_scale = .x$unit_scale,"
"0","gain_color =  .x$gain_color,"
"0","comparison_snapshot = .x$comparison_snapshot,"
"0","comparison_snapshot_label = .x$comparison_snapshot_label,"
"0","plot_lower = FALSE"
"0",")) %>%"
"0","map2(parameters,~{"
"0","ggsave(paste0(path_to_plots,""country dotplots/pdf/country_dotplot_"",.y$variable,""_"",.y$gbif_region,"".pdf""),plot=.x,width=6,height=5)"
"0","ggsave(paste0(path_to_plots,""country dotplots/svg/country_dotplot_"",.y$variable,""_"",.y$gbif_region,"".svg""),plot=.x,width=6,height=5)"
"0","ggsave(paste0(path_to_plots,""country dotplots/jpg/country_dotplot_"",.y$variable,""_"",.y$gbif_region,"".jpg""),plot=.x,width=6,height=5,dpi=600)"
"0","})"
"1","Observations: 46
"
"1","Variables: 8
"
"1","$ title                   [3m[90m<chr>[39m[23m ""Austria"", ""Austria"", ""Belg...
"
"1",""
"1","$ date                    [3m[90m<chr>[39m[23m ""2015-01-19"", ""2020-01-01"",...
"
"1",""
"1","$ occ_count               [3m[90m<dbl>[39m[23m 2975288, 3699334, 7066534, ...
"
"1",""
"1","$ species_count           [3m[90m<dbl>[39m[23m 37509, 46202, 21985, 43443,...
"
"1",""
"1","$ occ_count_published     [3m[90m<dbl>[39m[23m 3254655, 3846688, 7811474, ...
"
"1",""
"1","$ species_count_published [3m[90m<dbl>[39m[23m 77152, 98567, 77905, 176189...
"
"1",""
"1","$ order_variable          [3m[90m<dbl>[39m[23m 3699334, 3699334, 35211204,...
"
"1",""
"1","$ title_                  [3m[90m<fct>[39m[23m Austria, Austria, Belgium, ...
"
